{% extends "bootstrap_5_layout.html" %}
{% set active_page = "comparison" %}

{% block content %}

    <h2>Comparison of Economic Indicators</h2>

    <div id="chart-container" height="700px"></div>

    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script type="text/javascript">
        console.log("COMPARISON DASHBOARD...");
    
        // fetch data from the API
        fetch('/api/comparison.json')
            .then(response => response.json())
            .then(data => {
                // access the data
                var inflationData = data.inflation;
                var interestData = data.interest;
                var treasuryData = data.treasury_yield;
                var unemploymentData = data.unemployment;
    
                console.log(inflationData);
                console.log(interestData);
                console.log(treasuryData);
                console.log(unemploymentData);
    
                // extract dates and values
                var dates = interestData.map(obj => obj["date"]);
                var interestRates = interestData.map(obj => parseFloat(obj["value"]) / 100.0);
                var treasuryRates = treasuryData.map(obj => parseFloat(obj["value"]) / 100.0);
                var unemploymentRates = unemploymentData.map(obj => parseFloat(obj["value"]) / 100.0);
    
                // extract dates and values for inflation separately because yearly not monthly
                var inflationRates = inflationData.map(obj => parseFloat(obj["value"]) / 100.0);
                var inflationDates = inflationData.map(obj => obj["date"]);

                // create series for all 4 variables
                var inflationSeries = {
                    x: inflationDates,
                    y: inflationRates,
                    mode: "lines+markers",
                    name: "Inflation Rate",
                };

                var interestSeries = {
                    x: dates,
                    y: interestRates,
                    mode: "lines+markers",
                    name: "Interest Rate"
                };
    
                var treasurySeries = {
                    x: dates,
                    y: treasuryRates,
                    mode: "lines+markers",
                    name: "Treasury Yield Rate"
                };
    
                var unemploymentSeries = {
                    x: dates,
                    y: unemploymentRates,
                    mode: "lines+markers",
                    name: "Unemployment Rate"
                };
    
                // put all 4 series into one array
                var data = [inflationSeries, interestSeries, treasurySeries, unemploymentSeries];
    
                // plot chart
                var layout = {
                    title: "Comparison of Economic Indicators",
                    height: 500,
                    xaxis: {
                        title: "Time"
                    },
                    yaxis: {
                        title: "Rate (%)",
                        tickformat: '.1%',
                    },
                    legend: {
                        x: 0.1,
                        y: 1.1,
                        orientation: 'h'
                    }
                };
    
                Plotly.newPlot("chart-container", data, layout, {responsive: true});
            })

            .catch(error => {
                console.error("Error fetching data: ", error);
            });
    </script>    

{% endblock %}