{% extends "bootstrap_5_layout.html" %}
{% set active_page = "unemployment" %}

{% block content %}

    <h2>Unemployment Rates in the US</h2>

    <div id="chart-container" height="700px"></div>

    <table class="table table-hover table-responsive caption-top">
        <caption>Unemployment rates in the US over the last 10 months:</caption>
        <thead>
            <tr>
                <th scope="col">Date</th>
                <th scope="col">Unemployment Rate</th>
            </tr>
        </thead>
        <tbody>

        {% for row in data[0:10] %}
            <tr>
                <td>{{ row["date"] }}</td>
                <td>{{ row["value"] }}%</td>
            </tr>
        {% endfor %}

        </tbody>
    </table>

    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script type="text/javascript">

        console.log("UNEMPLOYMENT DASHBOARD...")

        // use data from the router!
        var unemploymentData = JSON.parse('{{data | tojson}}') // https://stackoverflow.com/a/45132694/670433
        console.log(unemploymentData)

        var dates = unemploymentData.map(obj => obj["date"])
        var rates = unemploymentData.map(obj => parseFloat(obj["value"]) / 100.0)

        // visualize the data
        // see: https://plotly.com/javascript/line-charts/
        var series = {
            x: dates,
            y: rates,
            mode: "lines+markers"
        }
        var data = [series]
        var layout = {
            title: "Unemployment Rate by Month",
            height: 600,
            yaxis: {
                //tickformat: '%' // https://plotly.com/javascript/tick-formatting/
                tickformat: '.1%' // https://stackoverflow.com/questions/42043633/format-y-axis-as-percent-in-plot-ly
            }
        }
        Plotly.newPlot("chart-container", data, layout, {responsive: true})

    </script>

{% endblock %}